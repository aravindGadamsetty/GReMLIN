#!/bin/bash

###############################################################################

# HEAP_LIMIT: the maximum amount of memory to be allocated by the
# Java Virtual Machine (JVM) in megabytes.
# Corresponds to the "-Xmx" JVM option.
# The obsolete JCHEM_JAVA_OPTS environment variable may override this setting if
# specified.
# The default setting is "200".

HEAP_LIMIT=500

# SERVER_MODE: if set to "true", the Java Virtual Machine (JVM) spends more
# time with run time code opimization, resulting slower startup but higher
# execution speed after a prolonged period.
# Suitable for long runnig tasks.
# Corresponds to the "-server" JVM option.
# The obsolete JCHEM_JAVA_OPTS environment variable may override this setting if
# specified.
# The default setting is "false".

SERVER_MODE=false

###############################################################################

if [ -z "$HEAP_LIMIT" ] ; then
  HEAP_LIMIT=200
fi

if [ -z "$SERVER_MODE" ] ; then
  SERVER_MODE=false
fi

if [ "$SERVER_MODE" = "true" ] ; then
    SERVER_MODE="-server"
  else
    SERVER_MODE=""
fi

if [ -z "$OSTYPE" ]; then
      if which cygpath 1>/dev/null 2>/dev/null; then
              OSTYPE=cygwin
      fi
fi
mypath=$0
while [ -h "$mypath" ]; do  # Resolve symlinks
        ls=`ls -ld "$mypath"`
        link=`expr "$ls" : '.*-> \(.*\)$'`
        if expr "$link" : '\/' > /dev/null; then
                mypath="$link"
        else
                mypath=`dirname "$mypath"`/"$link"
        fi
done

if expr "$mypath" : '[^\/]' > /dev/null; then
	mypath="`pwd`/$mypath"
fi

case "$OSTYPE" in
cygwin*)
	dir="`dirname $mypath`"
	dir="`cygpath -w $dir`"
        CLASSPATH="$dir\\..\\lib\\jchem.jar;$CLASSPATH"
        basedir="$dir\\.."
        ;;
*)
        dir=`dirname $mypath`
        CLASSPATH="$dir/../lib/jchem.jar:$CLASSPATH"
        basedir="$dir/.."
        ;;
esac
export CLASSPATH

# Parse -X* java options
javaopts=""
for i in $@; do
	if echo "$1" | grep -e '^-X' > /dev/null; then
		javaopts="$javaopts $1"
		shift
	elif [ "$1" = "-server" ]; then
		javaopts="$javaopts $1"
		shift
	elif [ "$1" = "-client" ]; then
		javaopts="$javaopts $1"
		shift
	else
		break
	fi
done

if [ "$JCHEM_JAVA_OPTS" = "" ] ; then
	if echo $javaopts | grep -v -e '-Xmx' > /dev/null; then
		javaopts="$javaopts -Xmx${HEAP_LIMIT}M"
	fi
	if echo $javaopts | grep -v -e '-server' > /dev/null; then
		if echo $javaopts | grep -v -e '-client' > /dev/null; then
			javaopts="$javaopts $SERVER_MODE"
		fi
	fi
else
	javaopts="$JCHEM_JAVA_OPTS $javaopts"
fi

JVMPATH="java"
if [ -f "$basedir/bin/setup" ]; then
    . "$basedir/bin/setup"
fi
# ------------------------ END OF HEADER ---------------------------

$JVMPATH $javaopts chemaxon.jchem.Search "$@"
